# Piezo Buzzer
피에조 버저(Piezo Buzzer)는 **압전(피에조) 소자에 전압을 인가하여 진동을 발생시키고, 그 진동을 통해 소리를 내는 부품**입니다.  
간단한 구조로 되어 있으며, 알람이나 부저음, 멜로디 출력 등 다양한 용도로 사용됩니다.

피에조 버저는 내부 구조에 따라 **능동형(Active)** 과 **수동형(Passive)** 으로 구분됩니다.

| 구분 | 설명 | 특징 |
|------|------|------|
| 능동형(Active) | 내부에 발진 회로가 있어 전원을 인가하면 자동으로 소리가 남 | 한 가지 음만 출력 가능, 간단한 알람용 |
| 수동형(Passive) | 내부 발진 회로가 없고, 외부에서 PWM 주파수를 인가해야 함 | 사용자가 직접 음의 높이(주파수)를 제어 가능 |

이번 실습에서는 **수동형 피에조 버저**를 사용합니다.  
PWM 신호의 **주파수(Frequency)** 는 음의 높이를, **듀티비(Duty)** 와 **출력 시간** 은 음의 크기와 길이를 결정합니다.

## Piezo Buzzer의 기본 원리
피에조 소자는 전압이 가해질 때 미세하게 진동하는 특성을 가지고 있습니다.  
이 진동이 공기를 울리게 되어 소리가 발생하며, 진동수(Hz)가 클수록 높은 음이, 작을수록 낮은 음이 들리게 됩니다.

- **전압**: Raspberry Pi Pico에서는 3.3V 출력이 기본이며, 대부분의 피에조 버저는 이 전압에서 정상 작동합니다.  
- **연결 방식**: 간단한 실습에서는 GPIO 핀과 GND에 직접 연결합니다.  
  더 큰 소리가 필요할 경우, **트랜지스터**를 이용한 스위칭 회로를 사용할 수도 있습니다.
- **듀티비(Duty cycle)**: 50%를 기본으로 하며, 30~70% 범위에서 음질 변화를 실험할 수 있습니다.  
- **무음 간격(Rest)**: 음과 음 사이에 짧은 무음을 주어 멜로디가 또렷하게 들리도록 합니다.

## Piezo Buzzer 음계 주파수
아래 표는 Piezo Buzzer 에서 출력 가능한 음계와 주파수를 표현한 표입니다. 출력 원하는 음계를 아래 표를 참고하여 활용할 수 있습니다. 

일반적으로 음악에 사용되는 높은음 자리표의 도는 C4의 C 입니다. 

| 옥타브 | C  | C♯/D♭ | D  | D♯/E♭ | E  | F  | F♯/G♭ | G  | G♯/A♭ | A  | A♯/B♭ | B  |
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| **C0** | 16.35 | 17.32 | 18.35 | 19.45 | 20.60 | 21.83 | 23.12 | 24.50 | 25.96 | 27.50 | 29.14 | 30.87 |
| **C1** | 32.70 | 34.65 | 36.71 | 38.89 | 41.20 | 43.65 | 46.25 | 49.00 | 51.91 | 55.00 | 58.27 | 61.74 |
| **C2** | 65.41 | 69.30 | 73.42 | 77.78 | 82.41 | 87.31 | 92.50 | 98.00 | 103.83 | 110.00 | 116.54 | 123.47 |
| **C3** | 130.81 | 138.59 | 146.83 | 155.56 | 164.81 | 174.61 | 185.00 | 196.00 | 207.65 | 220.00 | 233.08 | 246.94 |
| **C4** | 261.63 | 277.18 | 293.66 | 311.13 | 329.63 | 349.23 | 369.99 | 392.00 | 415.30 | 440.00 | 466.16 | 493.88 |
| **C5** | 523.25 | 554.37 | 587.33 | 622.25 | 659.25 | 698.46 | 739.99 | 783.99 | 830.61 | 880.00 | 932.33 | 987.77 |
| **C6** | 1046.50 | 1108.73 | 1174.66 | 1244.51 | 1318.51 | 1396.91 | 1479.98 | 1567.98 | 1661.22 | 1760.00 | 1864.66 | 1975.53 |
| **C7** | 2093.00 | 2217.46 | 2349.32 | 2489.02 | 2637.02 | 2793.83 | 2959.96 | 3135.96 | 3322.44 | 3520.00 | 3729.31 | 3951.07 |
| **C8** | 4186.01 | 4434.92 | 4698.63 | 4978.03 | 5274.04 | 5587.65 | 5919.91 | 6271.93 | 6644.88 | 7040.00 | 7458.62 | 7902.13 |


## Piezo Buzzer 연결 구성 

| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| 5V | +5V | 전원 |
| GND | GND | 접지 |
| GP15 | Piezo | 데이터 송신 |

![Piezo Connection](res/piezo%20connection.png)

## Piezo Buzzer 제어 코드 
피에조 버저를 PWM 주파수로 제어하여 C4~C6 음계를 순서대로 재생합니다. play_tone(freq, duration, duty)로 음높이(주파수)·길이·볼륨(듀티)을 조절하며, 음 사이에 짧은 무음을 두어 멜로디가 또렷하게 들리도록 구성하였습니다.

```python
from machine import Pin, PWM
import time

BUZZER_PIN = 15
buzzer = PWM(Pin(BUZZER_PIN))

NOTES = {
    'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23, 'G4': 392.00, 'A4': 440.00, 'B4': 493.88, 'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 'G5': 783.99, 'A5': 880.00, 'B5': 987.77, 'C6': 1046.50 
}

SCALE_ORDER = [
    'C4','D4','E4','F4','G4','A4','B4',
    'C5','D5','E5','F5','G5','A5','B5',
    'C6'
]

def play_tone(freq, duration=0.4, duty=0.5):
    buzzer.freq(int(freq))
    buzzer.duty_u16(int(65535 * duty))
    time.sleep(duration)
    buzzer.duty_u16(0)
    time.sleep(0.05)

def main():
    try:
        print("Piezo Buzzer Start")
        for name in SCALE_ORDER:
            f = NOTES[name]
            print(f"{name}: {f:.2f}Hz")
            play_tone(f)
        print("End")
    finally:
        buzzer.deinit()
        
if __name__ == "__main__":
    main()
```

다음 예제는 여러 음의 주파수와 재생 시간을 배열(notes[], duration[])로 지정하여
피에조 버저로 완성된 멜로디 곡을 재생하는 예제입니다.
각 음은 주어진 시간 동안 PWM 신호로 출력되며, SONGSPEED 값을 조정하여 전체 재생 속도를 쉽게 변경할 수 있습니다. 또한, REST=0으로 정의된 구간에서는 무음(쉼표) 이 적용됩니다.

```python
from machine import Pin, PWM
import time

BUZZER_PIN = 15
buzzer = PWM(Pin(BUZZER_PIN))
DUTY = 0.50
SONGSPEED = 1.5

NOTE_C4  = 262
NOTE_D4  = 294
NOTE_E4  = 330
NOTE_F4  = 349
NOTE_G4  = 392
NOTE_A4  = 440
NOTE_B4  = 494
NOTE_C5  = 523
NOTE_D5  = 587
NOTE_E5  = 659
NOTE_F5  = 698
NOTE_G5  = 784
NOTE_A5  = 880
NOTE_B5  = 988
REST     = 0  

notes = [
    NOTE_E4, NOTE_G4, NOTE_A4, NOTE_A4, REST,
    NOTE_A4, NOTE_B4, NOTE_C5, NOTE_C5, REST,
    NOTE_C5, NOTE_D5, NOTE_B4, NOTE_B4, REST,
    NOTE_A4, NOTE_G4, NOTE_A4, REST,

    NOTE_E4, NOTE_G4, NOTE_A4, NOTE_A4, REST,
    NOTE_A4, NOTE_B4, NOTE_C5, NOTE_C5, REST,
    NOTE_C5, NOTE_D5, NOTE_B4, NOTE_B4, REST,
    NOTE_A4, NOTE_G4, NOTE_A4, REST,

    NOTE_E4, NOTE_G4, NOTE_A4, NOTE_A4, REST,
    NOTE_A4, NOTE_C5, NOTE_D5, NOTE_D5, REST,
    NOTE_D5, NOTE_E5, NOTE_F5, NOTE_F5, REST,
    NOTE_E5, NOTE_D5, NOTE_E5, NOTE_A4, REST,

    NOTE_A4, NOTE_B4, NOTE_C5, NOTE_C5, REST,
    NOTE_D5, NOTE_E5, NOTE_A4, REST,
    NOTE_A4, NOTE_C5, NOTE_B4, NOTE_B4, REST,
    NOTE_C5, NOTE_A4, NOTE_B4, REST,

    NOTE_A4, NOTE_A4,

    NOTE_A4, NOTE_B4, NOTE_C5, NOTE_C5, REST,
    NOTE_C5, NOTE_D5, NOTE_B4, NOTE_B4, REST,
    NOTE_A4, NOTE_G4, NOTE_A4, REST,

    NOTE_E4, NOTE_G4, NOTE_A4, NOTE_A4, REST,
    NOTE_A4, NOTE_B4, NOTE_C5, NOTE_C5, REST,
    NOTE_C5, NOTE_D5, NOTE_B4, NOTE_B4, REST,
    NOTE_A4, NOTE_G4, NOTE_A4, REST,

    NOTE_E4, NOTE_G4, NOTE_A4, NOTE_A4, REST,
    NOTE_A4, NOTE_C5, NOTE_D5, NOTE_D5, REST,
    NOTE_D5, NOTE_E5, NOTE_F5, NOTE_F5, REST,
    NOTE_E5, NOTE_D5, NOTE_E5, NOTE_A4, REST,

    NOTE_A4, NOTE_B4, NOTE_C5, NOTE_C5, REST,
    NOTE_D5, NOTE_E5, NOTE_A4, REST,
    NOTE_A4, NOTE_C5, NOTE_B4, NOTE_B4, REST,
    NOTE_C5, NOTE_A4, NOTE_B4, REST,

    NOTE_E5, REST, REST, NOTE_F5, REST, REST,
    NOTE_E5, NOTE_E5, REST, NOTE_G5, REST, NOTE_E5, NOTE_D5, REST, REST,
    NOTE_D5, REST, REST, NOTE_C5, REST, REST,
    NOTE_B4, NOTE_C5, REST, NOTE_B4, REST, NOTE_A4,

    NOTE_E5, REST, REST, NOTE_F5, REST, REST,
    NOTE_E5, NOTE_E5, REST, NOTE_G5, REST, NOTE_E5, NOTE_D5, REST, REST,
    NOTE_D5, REST, REST, NOTE_C5, REST, REST,
    NOTE_B4, NOTE_C5, REST, NOTE_B4, REST, NOTE_A4
]

duration = [
    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 375, 125,

    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 375, 125,

    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 125, 250, 125,

    125, 125, 250, 125, 125,
    250, 125, 250, 125,
    125, 125, 250, 125, 125,
    125, 125, 375, 375,

    250, 125,
    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 375, 125,

    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 375, 125,

    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 250, 125, 125,
    125, 125, 125, 250, 125,

    125, 125, 250, 125, 125,
    250, 125, 250, 125,
    125, 125, 250, 125, 125,
    125, 125, 375, 375,

    250, 125, 375, 250, 125, 375,
    125, 125, 125, 125, 125, 125, 125, 125, 375,
    250, 125, 375, 250, 125, 375,
    125, 125, 125, 125, 125, 500,

    250, 125, 375, 250, 125, 375,
    125, 125, 125, 125, 125, 125, 125, 125, 375,
    250, 125, 375, 250, 125, 375,
    125, 125, 125, 125, 125, 500
]

def play_song(notes_list, dur_list, speed=1.0, duty=DUTY):
    try:
        for freq, dur_ms in zip(notes_list, dur_list):
            wait_ms = int(dur_ms * speed)
            if freq and freq > 0:
                buzzer.freq(int(freq))
                buzzer.duty_u16(int(65535 * duty))
                time.sleep_ms(wait_ms)
            else:
                buzzer.duty_u16(0)
                time.sleep_ms(wait_ms)
            buzzer.duty_u16(0)
    finally:
        buzzer.deinit()

if __name__ == "__main__":
    print("Play")
    play_song(notes, duration, speed=SONGSPEED, duty=DUTY)
    print("End")
```