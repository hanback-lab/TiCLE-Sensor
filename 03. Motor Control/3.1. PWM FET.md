# PWM FET 
## PWM
PWM은 **펄스 폭 변조(Pulse Width Modulation)** 라고 하며, 디지털 신호를 빠르게 켜고 끄는 방식을 통해 **출력 전압의 평균값을 조절하는 기술**입니다.  

예를 들어, 12V 전원을 아주 빠른 속도로 켜고 끄기를 반복한다고 가정해 보겠습니다.  
- 1초 중 50% 동안만 전원이 켜져 있다면 평균적으로 약 **6V 수준의 효과**가 나타납니다.  
- 즉, **듀티비(Duty Ratio)** 가 50%라면 12V의 절반 세기로 동작하게 됩니다.

PWM의 가장 큰 장점은, **에너지를 낭비하지 않고** 효율적으로 밝기, 속도, 세기 등을 제어할 수 있다는 점입니다. 이 때문에 LED 밝기 조절, DC 모터 속도 제어, 팬 속도 조절 등 다양한 전자 제어 시스템에서 널리 사용되고 있습니다.

## FET 
FET는 **전계 효과 트랜지스터(Field Effect Transistor)** 의 약자로, 작은 전압 신호를 이용해 큰 전류의 흐름을 제어할 수 있는 **전자 스위치**입니다.

특히, **MOSFET (Metal Oxide Semiconductor FET)** 은 스위칭 속도가 빠르고 전력 손실이 적어 **PWM 제어 회로에 매우 적합**합니다.

이 회로에서는 **N-채널 MOSFET**을 사용하여, PWM 신호가 들어오면 FET가 ON되어 부하(Lamp 또는 Fan)에 전류가 흐르고, PWM 신호가 꺼지면 FET가 OFF되어 부하가 차단됩니다.

즉, FET는 **MCU의 작은 제어 신호를 증폭시켜** 실제 12V 전류를 제어할 수 있도록 돕는 역할을 합니다.

## PWM FET + Lamp 연결 구성 
| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| 12V | +12V | 전원 |
| GND | GND | 접지 |
| GP15 | PWM1 | PWM Data |
| 12V | Cable(Red) | 램프의 전원(+) |
| P2 | Cable(Black) | FET를 통해 제어되는 램프의 음극 단자 |

![Lamp Connection](res/lamp%20connection.png)

## Lamp 제어 코드 
```python
from machine import Pin, PWM
import time

pwm_pin = PWM(Pin(15))
pwm_pin.freq(20000)
pwm_pin.duty_u16(0)

try:
    while True:
        for duty in range(0, 65535, 4096):
            pwm_pin.duty_u16(duty)
            time.sleep(0.05)
        for duty in range(65535, 0, -4096):
            pwm_pin.duty_u16(duty)
            time.sleep(0.05)
except KeyboardInterrupt:
    pwm_pin.deinit()
```
> - PWM(Pin(15)) : GPIO 15번 핀을 PWM 기능으로 사용합니다.
> - freq(20000) : PWM 주파수를 20kHz로 설정합니다. (LED나 Fan의 소음 방지)
> - duty_u16(value) : 듀티비(Duty Ratio)를 설정하는 함수로, 0은 완전 꺼짐(0%), 65535는 완전 켜짐(100%)을 의미합니다.
> - 반복문을 통해 램프의 밝기가 점점 밝아졌다가 어두워지는 효과를 확인할 수 있습니다.

## PWM FET + FAN 연결 구성 

| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| 12V | +12V | 전원 |
| GND | GND | 접지 |
| GP14 | PWM2 | PWM Data |
| 12V | Cable(Red) | 팬의 전원(+)  |
| P2 | Cable(Black) | FET를 통해 제어되는 팬의 음극 단자 |

![FAN Connection](res/fan%20connection.png)

## FAN 제어 코드 
```python
from machine import Pin, PWM
import time

pwm_fan = PWM(Pin(14))
pwm_fan.freq(25000)
pwm_fan.duty_u16(0)

try:
    while True:
        for duty in range(0, 65535, 8192):
            pwm_fan.duty_u16(duty)
            time.sleep(0.1)
        for duty in range(65535, 0, -8192):
            pwm_fan.duty_u16(duty)
            time.sleep(0.1)
except KeyboardInterrupt:
    pwm_fan.deinit()
```

> - PWM 주파수를 20kHz 이상으로 설정하면 팬에서 발생하는 “삐—” 하는 가청 소음을 줄일 수 있습니다.
> - 듀티비가 높아질수록 팬의 회전 속도가 빨라집니다.