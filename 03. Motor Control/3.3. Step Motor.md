# Step Motor
스텝 모터(Step Motor)는 회전 각도를 정밀하게 제어할 수 있는 모터입니다.
일반적인 DC 모터가 연속적으로 회전하는 것과 달리, 스텝 모터는 한 단계(step)씩 정해진 각도만큼 회전합니다.
이 각도를 **스텝 각(step angle)** 이라 하며, 모터의 내부 코일을 순서대로 자극함으로써 정밀한 위치 제어가 가능합니다.

## Step Motor 원리 
스텝 모터는 내부에 **고정자(stator)** 와 **회전자(rotor)** 가 있으며,
각 코일에 전류를 인가하는 순서에 따라 자력이 생성되어 회전자가 한 스텝씩 회전하게 됩니다.

| 스텝 모터 종류 | 1회전 스텝 수 | 스텝 각도 |
| :------: | :------: | :---: |
|  48-step |    48    |  7.5° |
| 200-step |    200   |  1.8° |
| 400-step |    400   |  0.9° |

## Step Motor 제어 방식 
스텝 모터의 제어 방식은 코일에 전류를 인가하는 **패턴(Phase Control)** 에 따라 다음과 같이 구분됩니다.

### 1상 여자(1-Phase Excitation)
한 번에 한 개의 코일만 자극하는 방식입니다. 
전류 소모가 적지만, 회전 토크가 작다는 단점이 있습니다.
정밀한 제어보다는 단순한 방향 전환 등에 적합합니다.

| Step |  A  |  /A |  B  |  /B |
| :--: | :-: | :-: | :-: | :-: |
|   1  |  1  |  0  |  0  |  0  |
|   2  |  0  |  0  |  1  |  0  |
|   3  |  0  |  1  |  0  |  0  |
|   4  |  0  |  0  |  0  |  1  |

### 2상 여자(2-Phase Excitation)
두 개의 코일을 동시에 자극하여 토크를 높이는 방식입니다.
1상에 비해 회전력이 강하며, 정지 시에도 위치 안정성이 높습니다.

| Step |  A  | /A |  B  | /B |
| :--: | :-: | :-: | :-: | :-: |
|   1  |  1  |  0  |  1  |  0  |
|   2  |  0  |  0  |  1  |  1  |
|   3  |  0  |  1  |  0  |  1  |
|   4  |  1  |  1  |  0  |  0  |

### 1-2상 혼합 여자(3상 제어 유사 형태)
1상과 2상 여자를 교대로 사용하는 하이브리드 방식입니다.
즉, 1상 → 2상 → 1상 → 2상 순서로 제어하여 스텝 각을 절반으로 줄입니다.
따라서 **더 높은 해상도(정밀 제어)**와 부드러운 회전이 가능합니다.
이 방식은 ‘Half Step’ 또는 ‘Micro Step’ 제어라고도 불립니다.

| Step |  A  | /A |  B  | /B | 특징 |
| :--: | :-: | :-: | :-: | :-: | :--- |
|   1  |  1  |  0  |  0  |  0  | 1상 여자 |
|   2  |  1  |  0  |  1  |  0  | 2상 여자 |
|   3  |  0  |  0  |  1  |  0  | 1상 여자 |
|   4  |  0  |  0  |  1  |  1  | 2상 여자 |
|   5  |  0  |  1  |  0  |  1  | 1상 여자 |
|   6  |  1  |  1  |  0  |  1  | 2상 여자 |
|   7  |  1  |  0  |  0  |  0  | 1상 여자 |


## Step DRV + Step Motor 연결 구성 
| Pin | 연결 대상 | 설명 |
|:---:|:---:|:---|
| 12V | +12V | 전원 |
| GND | GND | 접지 |
| GP27 | EN | PWM 제어 |
| GP12 | A | Coil A |
| GP13 | /A | Coil /A |
| GP14 | B | Coil B |
| GP15 | /B | Coil /B |

![Step Connection](res/step%20connection.png)

## Step Motor 제어 코드 
```python
from machine import Pin
import utime

EN  = Pin(27, Pin.OUT, value=1)
INA = Pin(12, Pin.OUT, value=0)
INNA = Pin(13, Pin.OUT, value=0)
INB = Pin(14, Pin.OUT, value=0)
INNB = Pin(15, Pin.OUT, value=0)

def forward():
    INA.value(1)
    INB.value(1)
    INNA.value(0)
    INNB.value(0)
    utime.sleep_ms(10)
    INA.value(0)
    INB.value(1)
    INNA.value(1)
    INNB.value(0)
    utime.sleep_ms(10)
    INA.value(0)
    INB.value(0)
    INNA.value(1)
    INNB.value(1)
    utime.sleep_ms(10)
    INA.value(1)
    INB.value(0)
    INNA.value(0)
    INNB.value(1)
    utime.sleep_ms(10)

def reverse():
    INA.value(1)
    INB.value(0)
    INNA.value(0)
    INNB.value(1)
    utime.sleep_ms(10)
    INA.value(0)
    INB.value(0)
    INNA.value(1)
    INNB.value(1)
    utime.sleep_ms(10)
    INA.value(0)
    INB.value(1)
    INNA.value(1)
    INNB.value(0)
    utime.sleep_ms(10)
    INA.value(1)
    INB.value(1)
    INNA.value(0)
    INNB.value(0)
    utime.sleep_ms(10)

def stop():
    INA.value(0)
    INB.value(0)
    INNA.value(0)
    INNB.value(0)

while True:
    for i in range(100):
        forward()
    for i in range(100):
        reverse()
    stop()
```